{"ast":null,"code":"import { distinctUntilChanged, filter, map, shareReplay, startWith } from 'rxjs/operators';\nimport { clone, trimDots, pluginMissing, flatClone, PROMISE_RESOLVE_NULL, RXJS_SHARE_REPLAY_DEFAULTS, getProperty, getFromMapOrCreate } from \"./plugins/utils/index.js\";\nimport { newRxError } from \"./rx-error.js\";\nimport { runPluginHooks } from \"./hooks.js\";\nimport { getDocumentDataOfRxChangeEvent } from \"./rx-change-event.js\";\nimport { overwritable } from \"./overwritable.js\";\nimport { getSchemaByObjectPath } from \"./rx-schema-helper.js\";\nimport { throwIfIsStorageWriteError } from \"./rx-storage-helper.js\";\nimport { modifierFromPublicToInternal } from \"./incremental-write.js\";\nexport var basePrototype = {\n  get primaryPath() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.collection.schema.primaryPath;\n  },\n  get primary() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data[_this.primaryPath];\n  },\n  get revision() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._rev;\n  },\n  get deleted$() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this.$.pipe(map(d => d._data._deleted));\n  },\n  get deleted$$() {\n    var _this = this;\n    var reactivity = _this.collection.database.getReactivityFactory();\n    return reactivity.fromObservable(_this.deleted$, _this.getLatest().deleted, _this.collection.database);\n  },\n  get deleted() {\n    var _this = this;\n    if (!_this.isInstanceOfRxDocument) {\n      return undefined;\n    }\n    return _this._data._deleted;\n  },\n  getLatest() {\n    var latestDocData = this.collection._docCache.getLatestDocumentData(this.primary);\n    return this.collection._docCache.getCachedRxDocument(latestDocData);\n  },\n  /**\n   * returns the observable which emits the plain-data of this document\n   */\n  get $() {\n    var _this = this;\n    return _this.collection.$.pipe(filter(changeEvent => !changeEvent.isLocal), filter(changeEvent => changeEvent.documentId === this.primary), map(changeEvent => getDocumentDataOfRxChangeEvent(changeEvent)), startWith(_this.collection._docCache.getLatestDocumentData(this.primary)), distinctUntilChanged((prev, curr) => prev._rev === curr._rev), map(docData => this.collection._docCache.getCachedRxDocument(docData)), shareReplay(RXJS_SHARE_REPLAY_DEFAULTS));\n  },\n  get $$() {\n    var _this = this;\n    var reactivity = _this.collection.database.getReactivityFactory();\n    return reactivity.fromObservable(_this.$, _this.getLatest()._data, _this.collection.database);\n  },\n  /**\n   * returns observable of the value of the given path\n   */\n  get$(path) {\n    if (overwritable.isDevMode()) {\n      if (path.includes('.item.')) {\n        throw newRxError('DOC1', {\n          path\n        });\n      }\n      if (path === this.primaryPath) {\n        throw newRxError('DOC2');\n      }\n\n      // final fields cannot be modified and so also not observed\n      if (this.collection.schema.finalFields.includes(path)) {\n        throw newRxError('DOC3', {\n          path\n        });\n      }\n      var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n      if (!schemaObj) {\n        throw newRxError('DOC4', {\n          path\n        });\n      }\n    }\n    return this.$.pipe(map(data => getProperty(data, path)), distinctUntilChanged());\n  },\n  get$$(path) {\n    var obs = this.get$(path);\n    var reactivity = this.collection.database.getReactivityFactory();\n    return reactivity.fromObservable(obs, this.getLatest().get(path), this.collection.database);\n  },\n  /**\n   * populate the given path\n   */\n  populate(path) {\n    var schemaObj = getSchemaByObjectPath(this.collection.schema.jsonSchema, path);\n    var value = this.get(path);\n    if (!value) {\n      return PROMISE_RESOLVE_NULL;\n    }\n    if (!schemaObj) {\n      throw newRxError('DOC5', {\n        path\n      });\n    }\n    if (!schemaObj.ref) {\n      throw newRxError('DOC6', {\n        path,\n        schemaObj\n      });\n    }\n    var refCollection = this.collection.database.collections[schemaObj.ref];\n    if (!refCollection) {\n      throw newRxError('DOC7', {\n        ref: schemaObj.ref,\n        path,\n        schemaObj\n      });\n    }\n    if (schemaObj.type === 'array') {\n      return refCollection.findByIds(value).exec().then(res => {\n        var valuesIterator = res.values();\n        return Array.from(valuesIterator);\n      });\n    } else {\n      return refCollection.findOne(value).exec();\n    }\n  },\n  /**\n   * get data by objectPath\n   * @hotPath Performance here is really important,\n   * run some tests before changing anything.\n   */\n  get(objPath) {\n    return getFromMapOrCreate(this._propertyCache, objPath, () => {\n      var valueObj = getProperty(this._data, objPath);\n\n      // direct return if array or non-object\n      if (typeof valueObj !== 'object' || valueObj === null || Array.isArray(valueObj)) {\n        return overwritable.deepFreezeWhenDevMode(valueObj);\n      }\n      var _this = this;\n      var proxy = new Proxy(\n      /**\n       * In dev-mode, the _data is deep-frozen\n       * so we have to flat clone here so that\n       * the proxy can work.\n       */\n      flatClone(valueObj), {\n        get(target, property) {\n          if (typeof property !== 'string') {\n            return target[property];\n          }\n          var lastChar = property.charAt(property.length - 1);\n          if (property.endsWith('$$')) {\n            var key = property.slice(0, -2);\n            return _this.get$$(trimDots(objPath + '.' + key));\n          } else if (lastChar === '$') {\n            var _key = property.slice(0, -1);\n            return _this.get$(trimDots(objPath + '.' + _key));\n          } else if (lastChar === '_') {\n            var _key2 = property.slice(0, -1);\n            return _this.populate(trimDots(objPath + '.' + _key2));\n          } else {\n            return _this.get(trimDots(objPath + '.' + property));\n          }\n        }\n      });\n      return proxy;\n    });\n  },\n  toJSON(withMetaFields = false) {\n    if (!withMetaFields) {\n      var data = flatClone(this._data);\n      delete data._rev;\n      delete data._attachments;\n      delete data._deleted;\n      delete data._meta;\n      return overwritable.deepFreezeWhenDevMode(data);\n    } else {\n      return overwritable.deepFreezeWhenDevMode(this._data);\n    }\n  },\n  toMutableJSON(withMetaFields = false) {\n    return clone(this.toJSON(withMetaFields));\n  },\n  /**\n   * updates document\n   * @overwritten by plugin (optional)\n   * @param updateObj mongodb-like syntax\n   */\n  update(_updateObj) {\n    throw pluginMissing('update');\n  },\n  incrementalUpdate(_updateObj) {\n    throw pluginMissing('update');\n  },\n  updateCRDT(_updateObj) {\n    throw pluginMissing('crdt');\n  },\n  putAttachment() {\n    throw pluginMissing('attachments');\n  },\n  getAttachment() {\n    throw pluginMissing('attachments');\n  },\n  allAttachments() {\n    throw pluginMissing('attachments');\n  },\n  get allAttachments$() {\n    throw pluginMissing('attachments');\n  },\n  async modify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    var oldData = this._data;\n    var newData = await modifierFromPublicToInternal(mutationFunction)(oldData);\n    return this._saveData(newData, oldData);\n  },\n  /**\n   * runs an incremental update over the document\n   * @param function that takes the document-data and returns a new data-object\n   */\n  incrementalModify(mutationFunction,\n  // used by some plugins that wrap the method\n  _context) {\n    return this.collection.incrementalWriteQueue.addWrite(this._data, modifierFromPublicToInternal(mutationFunction)).then(result => this.collection._docCache.getCachedRxDocument(result));\n  },\n  patch(patch) {\n    var oldData = this._data;\n    var newData = clone(oldData);\n    Object.entries(patch).forEach(([k, v]) => {\n      newData[k] = v;\n    });\n    return this._saveData(newData, oldData);\n  },\n  /**\n   * patches the given properties\n   */\n  incrementalPatch(patch) {\n    return this.incrementalModify(docData => {\n      Object.entries(patch).forEach(([k, v]) => {\n        docData[k] = v;\n      });\n      return docData;\n    });\n  },\n  /**\n   * saves the new document-data\n   * and handles the events\n   */\n  async _saveData(newData, oldData) {\n    newData = flatClone(newData);\n\n    // deleted documents cannot be changed\n    if (this._data._deleted) {\n      throw newRxError('DOC11', {\n        id: this.primary,\n        document: this\n      });\n    }\n    await beforeDocumentUpdateWrite(this.collection, newData, oldData);\n    var writeResult = await this.collection.storageInstance.bulkWrite([{\n      previous: oldData,\n      document: newData\n    }], 'rx-document-save-data');\n    var isError = writeResult.error[0];\n    throwIfIsStorageWriteError(this.collection, this.primary, newData, isError);\n    await this.collection._runHooks('post', 'save', newData, this);\n    return this.collection._docCache.getCachedRxDocument(writeResult.success[0]);\n  },\n  /**\n   * Remove the document.\n   * Notice that there is no hard delete,\n   * instead deleted documents get flagged with _deleted=true.\n   */\n  remove() {\n    var collection = this.collection;\n    if (this.deleted) {\n      return Promise.reject(newRxError('DOC13', {\n        document: this,\n        id: this.primary\n      }));\n    }\n    var deletedData = flatClone(this._data);\n    var removedDocData;\n    return collection._runHooks('pre', 'remove', deletedData, this).then(async () => {\n      deletedData._deleted = true;\n      var writeResult = await collection.storageInstance.bulkWrite([{\n        previous: this._data,\n        document: deletedData\n      }], 'rx-document-remove');\n      var isError = writeResult.error[0];\n      throwIfIsStorageWriteError(collection, this.primary, deletedData, isError);\n      return writeResult.success[0];\n    }).then(removed => {\n      removedDocData = removed;\n      return this.collection._runHooks('post', 'remove', deletedData, this);\n    }).then(() => {\n      return this.collection._docCache.getCachedRxDocument(removedDocData);\n    });\n  },\n  incrementalRemove() {\n    return this.incrementalModify(async docData => {\n      await this.collection._runHooks('pre', 'remove', docData, this);\n      docData._deleted = true;\n      return docData;\n    }).then(async newDoc => {\n      await this.collection._runHooks('post', 'remove', newDoc._data, newDoc);\n      return newDoc;\n    });\n  },\n  destroy() {\n    throw newRxError('DOC14');\n  }\n};\nexport function createRxDocumentConstructor(proto = basePrototype) {\n  var constructor = function RxDocumentConstructor(collection, docData) {\n    this.collection = collection;\n\n    // assume that this is always equal to the doc-data in the database\n    this._data = docData;\n    this._propertyCache = new Map();\n\n    /**\n     * because of the prototype-merge,\n     * we can not use the native instanceof operator\n     */\n    this.isInstanceOfRxDocument = true;\n  };\n  constructor.prototype = proto;\n  return constructor;\n}\nexport function createWithConstructor(constructor, collection, jsonData) {\n  var doc = new constructor(collection, jsonData);\n  runPluginHooks('createRxDocument', doc);\n  return doc;\n}\nexport function isRxDocument(obj) {\n  return typeof obj === 'object' && obj !== null && 'isInstanceOfRxDocument' in obj;\n}\nexport function beforeDocumentUpdateWrite(collection, newData, oldData) {\n  /**\n   * Meta values must always be merged\n   * instead of overwritten.\n   * This ensures that different plugins do not overwrite\n   * each others meta properties.\n   */\n  newData._meta = Object.assign({}, oldData._meta, newData._meta);\n\n  // ensure modifications are ok\n  if (overwritable.isDevMode()) {\n    collection.schema.validateChange(oldData, newData);\n  }\n  return collection._runHooks('pre', 'save', newData, oldData);\n}","map":{"version":3,"names":["distinctUntilChanged","filter","map","shareReplay","startWith","clone","trimDots","pluginMissing","flatClone","PROMISE_RESOLVE_NULL","RXJS_SHARE_REPLAY_DEFAULTS","getProperty","getFromMapOrCreate","newRxError","runPluginHooks","getDocumentDataOfRxChangeEvent","overwritable","getSchemaByObjectPath","throwIfIsStorageWriteError","modifierFromPublicToInternal","basePrototype","primaryPath","_this","isInstanceOfRxDocument","undefined","collection","schema","primary","_data","revision","_rev","deleted$","$","pipe","d","_deleted","deleted$$","reactivity","database","getReactivityFactory","fromObservable","getLatest","deleted","latestDocData","_docCache","getLatestDocumentData","getCachedRxDocument","changeEvent","isLocal","documentId","prev","curr","docData","$$","get$","path","isDevMode","includes","finalFields","schemaObj","jsonSchema","data","get$$","obs","get","populate","value","ref","refCollection","collections","type","findByIds","exec","then","res","valuesIterator","values","Array","from","findOne","objPath","_propertyCache","valueObj","isArray","deepFreezeWhenDevMode","proxy","Proxy","target","property","lastChar","charAt","length","endsWith","key","slice","_key","_key2","toJSON","withMetaFields","_attachments","_meta","toMutableJSON","update","_updateObj","incrementalUpdate","updateCRDT","putAttachment","getAttachment","allAttachments","allAttachments$","modify","mutationFunction","_context","oldData","newData","_saveData","incrementalModify","incrementalWriteQueue","addWrite","result","patch","Object","entries","forEach","k","v","incrementalPatch","id","document","beforeDocumentUpdateWrite","writeResult","storageInstance","bulkWrite","previous","isError","error","_runHooks","success","remove","Promise","reject","deletedData","removedDocData","removed","incrementalRemove","newDoc","destroy","createRxDocumentConstructor","proto","constructor","RxDocumentConstructor","Map","prototype","createWithConstructor","jsonData","doc","isRxDocument","obj","assign","validateChange"],"sources":["/Users/abdelghanem/Desktop/tasker/node_modules/rxdb/src/rx-document.ts"],"sourcesContent":["import {\n    Observable\n} from 'rxjs';\nimport {\n    distinctUntilChanged,\n    filter,\n    map,\n    shareReplay,\n    startWith\n} from 'rxjs/operators';\nimport {\n    clone,\n    trimDots,\n    pluginMissing,\n    flatClone,\n    PROMISE_RESOLVE_NULL,\n    RXJS_SHARE_REPLAY_DEFAULTS,\n    getProperty,\n    getFromMapOrCreate\n} from './plugins/utils/index.ts';\nimport {\n    newRxError\n} from './rx-error.ts';\nimport {\n    runPluginHooks\n} from './hooks.ts';\n\nimport type {\n    RxDocument,\n    RxCollection,\n    RxDocumentData,\n    RxDocumentWriteData,\n    UpdateQuery,\n    CRDTEntry,\n    ModifyFunction\n} from './types/index.d.ts';\nimport { getDocumentDataOfRxChangeEvent } from './rx-change-event.ts';\nimport { overwritable } from './overwritable.ts';\nimport { getSchemaByObjectPath } from './rx-schema-helper.ts';\nimport { throwIfIsStorageWriteError } from './rx-storage-helper.ts';\nimport { modifierFromPublicToInternal } from './incremental-write.ts';\n\nexport const basePrototype = {\n    get primaryPath() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this.collection.schema.primaryPath;\n    },\n    get primary() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return (_this._data as any)[_this.primaryPath];\n    },\n    get revision() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._data._rev;\n    },\n    get deleted$() {\n        const _this: RxDocument<any> = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this.$.pipe(\n            map((d: any) => d._data._deleted)\n        );\n    },\n    get deleted$$() {\n        const _this: RxDocument = this as any;\n        const reactivity = _this.collection.database.getReactivityFactory();\n        return reactivity.fromObservable(\n            _this.deleted$,\n            _this.getLatest().deleted,\n            _this.collection.database\n        );\n    },\n    get deleted() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._data._deleted;\n    },\n\n    getLatest(this: RxDocument): RxDocument {\n        const latestDocData = this.collection._docCache.getLatestDocumentData(this.primary);\n        return this.collection._docCache.getCachedRxDocument(latestDocData);\n    },\n\n    /**\n     * returns the observable which emits the plain-data of this document\n     */\n    get $(): Observable<RxDocumentData<any>> {\n        const _this: RxDocument<{}, {}, {}> = this as any;\n        return _this.collection.$.pipe(\n            filter(changeEvent => !changeEvent.isLocal),\n            filter(changeEvent => changeEvent.documentId === this.primary),\n            map(changeEvent => getDocumentDataOfRxChangeEvent(changeEvent)),\n            startWith(_this.collection._docCache.getLatestDocumentData(this.primary)),\n            distinctUntilChanged((prev, curr) => prev._rev === curr._rev),\n            map(docData => (this as RxDocument<any>).collection._docCache.getCachedRxDocument(docData)),\n            shareReplay(RXJS_SHARE_REPLAY_DEFAULTS)\n        );\n    },\n    get $$(): any {\n        const _this: RxDocument = this as any;\n        const reactivity = _this.collection.database.getReactivityFactory();\n        return reactivity.fromObservable(\n            _this.$,\n            _this.getLatest()._data,\n            _this.collection.database\n        );\n    },\n\n    /**\n     * returns observable of the value of the given path\n     */\n    get$(this: RxDocument, path: string): Observable<any> {\n        if (overwritable.isDevMode()) {\n            if (path.includes('.item.')) {\n                throw newRxError('DOC1', {\n                    path\n                });\n            }\n\n            if (path === this.primaryPath) {\n                throw newRxError('DOC2');\n            }\n\n            // final fields cannot be modified and so also not observed\n            if (this.collection.schema.finalFields.includes(path)) {\n                throw newRxError('DOC3', {\n                    path\n                });\n            }\n\n            const schemaObj = getSchemaByObjectPath(\n                this.collection.schema.jsonSchema,\n                path\n            );\n\n            if (!schemaObj) {\n                throw newRxError('DOC4', {\n                    path\n                });\n            }\n        }\n\n        return this.$\n            .pipe(\n                map(data => getProperty(data, path)),\n                distinctUntilChanged()\n            );\n    },\n    get$$(this: RxDocument, path: string) {\n        const obs = this.get$(path);\n        const reactivity = this.collection.database.getReactivityFactory();\n        return reactivity.fromObservable(\n            obs,\n            this.getLatest().get(path),\n            this.collection.database\n        );\n    },\n\n    /**\n     * populate the given path\n     */\n    populate(this: RxDocument, path: string): Promise<RxDocument | null> {\n        const schemaObj = getSchemaByObjectPath(\n            this.collection.schema.jsonSchema,\n            path\n        );\n        const value = this.get(path);\n        if (!value) {\n            return PROMISE_RESOLVE_NULL;\n        }\n        if (!schemaObj) {\n            throw newRxError('DOC5', {\n                path\n            });\n        }\n        if (!schemaObj.ref) {\n            throw newRxError('DOC6', {\n                path,\n                schemaObj\n            });\n        }\n\n        const refCollection: RxCollection = this.collection.database.collections[schemaObj.ref];\n        if (!refCollection) {\n            throw newRxError('DOC7', {\n                ref: schemaObj.ref,\n                path,\n                schemaObj\n            });\n        }\n\n        if (schemaObj.type === 'array') {\n            return refCollection.findByIds(value).exec().then(res => {\n                const valuesIterator = res.values();\n                return Array.from(valuesIterator) as any;\n            });\n        } else {\n            return refCollection.findOne(value).exec();\n        }\n    },\n    /**\n     * get data by objectPath\n     * @hotPath Performance here is really important,\n     * run some tests before changing anything.\n     */\n    get(this: RxDocument, objPath: string): any | null {\n        return getFromMapOrCreate(\n            this._propertyCache,\n            objPath,\n            () => {\n                const valueObj = getProperty(this._data, objPath);\n\n                // direct return if array or non-object\n                if (\n                    typeof valueObj !== 'object' ||\n                    valueObj === null ||\n                    Array.isArray(valueObj)\n                ) {\n                    return overwritable.deepFreezeWhenDevMode(valueObj);\n                }\n                const _this = this;\n                const proxy = new Proxy(\n                    /**\n                     * In dev-mode, the _data is deep-frozen\n                     * so we have to flat clone here so that\n                     * the proxy can work.\n                     */\n                    flatClone(valueObj),\n                    {\n                        get(target, property: any) {\n                            if (typeof property !== 'string') {\n                                return target[property];\n                            }\n                            const lastChar = property.charAt(property.length - 1);\n                            if (property.endsWith('$$')) {\n                                const key = property.slice(0, -2);\n                                return _this.get$$(trimDots(objPath + '.' + key));\n                            } else if (lastChar === '$') {\n                                const key = property.slice(0, -1);\n                                return _this.get$(trimDots(objPath + '.' + key));\n                            } else if (lastChar === '_') {\n                                const key = property.slice(0, -1);\n                                return _this.populate(trimDots(objPath + '.' + key));\n                            } else {\n                                return _this.get(trimDots(objPath + '.' + property));\n                            }\n                        }\n                    });\n                return proxy;\n            }\n        );\n\n    },\n\n    toJSON(this: RxDocument, withMetaFields = false) {\n        if (!withMetaFields) {\n            const data = flatClone(this._data);\n            delete (data as any)._rev;\n            delete (data as any)._attachments;\n            delete (data as any)._deleted;\n            delete (data as any)._meta;\n            return overwritable.deepFreezeWhenDevMode(data);\n        } else {\n            return overwritable.deepFreezeWhenDevMode(this._data);\n        }\n    },\n    toMutableJSON(this: RxDocument, withMetaFields = false) {\n        return clone(this.toJSON(withMetaFields as any));\n    },\n\n    /**\n     * updates document\n     * @overwritten by plugin (optional)\n     * @param updateObj mongodb-like syntax\n     */\n    update(_updateObj: UpdateQuery<any>) {\n        throw pluginMissing('update');\n    },\n    incrementalUpdate(_updateObj: UpdateQuery<any>) {\n        throw pluginMissing('update');\n    },\n    updateCRDT(_updateObj: CRDTEntry<any> | CRDTEntry<any>[]) {\n        throw pluginMissing('crdt');\n    },\n    putAttachment() {\n        throw pluginMissing('attachments');\n    },\n    getAttachment() {\n        throw pluginMissing('attachments');\n    },\n    allAttachments() {\n        throw pluginMissing('attachments');\n    },\n    get allAttachments$() {\n        throw pluginMissing('attachments');\n    },\n\n    async modify<RxDocType>(\n        this: RxDocument<RxDocType>,\n        mutationFunction: ModifyFunction<RxDocType>,\n        // used by some plugins that wrap the method\n        _context?: string\n    ): Promise<RxDocument> {\n        const oldData = this._data;\n        const newData: RxDocumentData<RxDocType> = await modifierFromPublicToInternal<RxDocType>(mutationFunction)(oldData) as any;\n        return this._saveData(newData, oldData) as any;\n    },\n\n    /**\n     * runs an incremental update over the document\n     * @param function that takes the document-data and returns a new data-object\n     */\n    incrementalModify(\n        this: RxDocument,\n        mutationFunction: ModifyFunction<any>,\n        // used by some plugins that wrap the method\n        _context?: string\n    ): Promise<RxDocument> {\n        return this.collection.incrementalWriteQueue.addWrite(\n            this._data,\n            modifierFromPublicToInternal(mutationFunction)\n        ).then(result => this.collection._docCache.getCachedRxDocument(result));\n    },\n\n    patch<RxDocType>(\n        this: RxDocument<RxDocType>,\n        patch: Partial<RxDocType>\n    ) {\n        const oldData = this._data;\n        const newData = clone(oldData);\n        Object\n            .entries(patch)\n            .forEach(([k, v]) => {\n                (newData as any)[k] = v;\n            });\n        return this._saveData(newData, oldData);\n    },\n\n    /**\n     * patches the given properties\n     */\n    incrementalPatch<RxDocumentType = any>(\n        this: RxDocument<RxDocumentType>,\n        patch: Partial<RxDocumentType>\n    ): Promise<RxDocument<RxDocumentType>> {\n        return this.incrementalModify((docData) => {\n            Object\n                .entries(patch)\n                .forEach(([k, v]) => {\n                    (docData as any)[k] = v;\n                });\n            return docData;\n        });\n    },\n\n    /**\n     * saves the new document-data\n     * and handles the events\n     */\n    async _saveData<RxDocType>(\n        this: RxDocument<RxDocType>,\n        newData: RxDocumentWriteData<RxDocType>,\n        oldData: RxDocumentData<RxDocType>\n    ): Promise<RxDocument<RxDocType>> {\n        newData = flatClone(newData);\n\n        // deleted documents cannot be changed\n        if (this._data._deleted) {\n            throw newRxError('DOC11', {\n                id: this.primary,\n                document: this\n            });\n        }\n        await beforeDocumentUpdateWrite(this.collection, newData, oldData);\n        const writeResult = await this.collection.storageInstance.bulkWrite([{\n            previous: oldData,\n            document: newData\n        }], 'rx-document-save-data');\n\n        const isError = writeResult.error[0];\n        throwIfIsStorageWriteError(this.collection, this.primary, newData, isError);\n\n        await this.collection._runHooks('post', 'save', newData, this);\n        return this.collection._docCache.getCachedRxDocument(\n            writeResult.success[0]\n        );\n    },\n\n    /**\n     * Remove the document.\n     * Notice that there is no hard delete,\n     * instead deleted documents get flagged with _deleted=true.\n     */\n    remove(this: RxDocument): Promise<RxDocument> {\n        const collection = this.collection;\n        if (this.deleted) {\n            return Promise.reject(newRxError('DOC13', {\n                document: this,\n                id: this.primary\n            }));\n        }\n\n        const deletedData = flatClone(this._data);\n        let removedDocData: RxDocumentData<any>;\n        return collection._runHooks('pre', 'remove', deletedData, this)\n            .then(async () => {\n                deletedData._deleted = true;\n                const writeResult = await collection.storageInstance.bulkWrite([{\n                    previous: this._data,\n                    document: deletedData\n                }], 'rx-document-remove');\n                const isError = writeResult.error[0];\n                throwIfIsStorageWriteError(collection, this.primary, deletedData, isError);\n                return writeResult.success[0];\n            })\n            .then((removed) => {\n                removedDocData = removed;\n                return this.collection._runHooks('post', 'remove', deletedData, this);\n            })\n            .then(() => {\n                return this.collection._docCache.getCachedRxDocument(removedDocData);\n            });\n    },\n    incrementalRemove(this: RxDocument): Promise<RxDocument> {\n        return this.incrementalModify(async (docData) => {\n            await this.collection._runHooks('pre', 'remove', docData, this);\n            docData._deleted = true;\n            return docData;\n        }).then(async (newDoc) => {\n            await this.collection._runHooks('post', 'remove', newDoc._data, newDoc);\n            return newDoc;\n        });\n    },\n    destroy() {\n        throw newRxError('DOC14');\n    }\n};\n\nexport function createRxDocumentConstructor(proto = basePrototype) {\n    const constructor = function RxDocumentConstructor(\n        this: RxDocument,\n        collection: RxCollection,\n        docData: RxDocumentData<any>\n    ) {\n        this.collection = collection;\n\n        // assume that this is always equal to the doc-data in the database\n        this._data = docData;\n        this._propertyCache = new Map<string, any>();\n\n        /**\n         * because of the prototype-merge,\n         * we can not use the native instanceof operator\n         */\n        this.isInstanceOfRxDocument = true;\n    };\n    constructor.prototype = proto;\n    return constructor;\n}\n\nexport function createWithConstructor<RxDocType>(\n    constructor: any,\n    collection: RxCollection<RxDocType>,\n    jsonData: RxDocumentData<RxDocType>\n): RxDocument<RxDocType> | null {\n    const doc = new constructor(collection, jsonData);\n    runPluginHooks('createRxDocument', doc);\n    return doc;\n}\n\nexport function isRxDocument(obj: any): boolean {\n    return typeof obj === 'object' && obj !== null && 'isInstanceOfRxDocument' in obj;\n}\n\n\nexport function beforeDocumentUpdateWrite<RxDocType>(\n    collection: RxCollection<RxDocType>,\n    newData: RxDocumentWriteData<RxDocType>,\n    oldData: RxDocumentData<RxDocType>\n): Promise<any> {\n    /**\n     * Meta values must always be merged\n     * instead of overwritten.\n     * This ensures that different plugins do not overwrite\n     * each others meta properties.\n     */\n    newData._meta = Object.assign(\n        {},\n        oldData._meta,\n        newData._meta\n    );\n\n    // ensure modifications are ok\n    if (overwritable.isDevMode()) {\n        collection.schema.validateChange(oldData, newData);\n    }\n    return collection._runHooks('pre', 'save', newData, oldData);\n}\n\n"],"mappings":"AAGA,SACIA,oBAAoB,EACpBC,MAAM,EACNC,GAAG,EACHC,WAAW,EACXC,SAAS,QACN,gBAAgB;AACvB,SACIC,KAAK,EACLC,QAAQ,EACRC,aAAa,EACbC,SAAS,EACTC,oBAAoB,EACpBC,0BAA0B,EAC1BC,WAAW,EACXC,kBAAkB,QACf,0BAA0B;AACjC,SACIC,UAAU,QACP,eAAe;AACtB,SACIC,cAAc,QACX,YAAY;AAWnB,SAASC,8BAA8B,QAAQ,sBAAsB;AACrE,SAASC,YAAY,QAAQ,mBAAmB;AAChD,SAASC,qBAAqB,QAAQ,uBAAuB;AAC7D,SAASC,0BAA0B,QAAQ,wBAAwB;AACnE,SAASC,4BAA4B,QAAQ,wBAAwB;AAErE,OAAO,IAAMC,aAAa,GAAG;EACzB,IAAIC,WAAWA,CAAA,EAAG;IACd,IAAMC,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACC,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOF,KAAK,CAACG,UAAU,CAACC,MAAM,CAACL,WAAW;EAC9C,CAAC;EACD,IAAIM,OAAOA,CAAA,EAAG;IACV,IAAML,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACC,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAQF,KAAK,CAACM,KAAK,CAASN,KAAK,CAACD,WAAW,CAAC;EAClD,CAAC;EACD,IAAIQ,QAAQA,CAAA,EAAG;IACX,IAAMP,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACC,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOF,KAAK,CAACM,KAAK,CAACE,IAAI;EAC3B,CAAC;EACD,IAAIC,QAAQA,CAAA,EAAG;IACX,IAAMT,KAAsB,GAAG,IAAW;IAC1C,IAAI,CAACA,KAAK,CAACC,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOF,KAAK,CAACU,CAAC,CAACC,IAAI,CACf/B,GAAG,CAAEgC,CAAM,IAAKA,CAAC,CAACN,KAAK,CAACO,QAAQ,CACpC,CAAC;EACL,CAAC;EACD,IAAIC,SAASA,CAAA,EAAG;IACZ,IAAMd,KAAiB,GAAG,IAAW;IACrC,IAAMe,UAAU,GAAGf,KAAK,CAACG,UAAU,CAACa,QAAQ,CAACC,oBAAoB,CAAC,CAAC;IACnE,OAAOF,UAAU,CAACG,cAAc,CAC5BlB,KAAK,CAACS,QAAQ,EACdT,KAAK,CAACmB,SAAS,CAAC,CAAC,CAACC,OAAO,EACzBpB,KAAK,CAACG,UAAU,CAACa,QACrB,CAAC;EACL,CAAC;EACD,IAAII,OAAOA,CAAA,EAAG;IACV,IAAMpB,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACC,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOF,KAAK,CAACM,KAAK,CAACO,QAAQ;EAC/B,CAAC;EAEDM,SAASA,CAAA,EAA+B;IACpC,IAAME,aAAa,GAAG,IAAI,CAAClB,UAAU,CAACmB,SAAS,CAACC,qBAAqB,CAAC,IAAI,CAAClB,OAAO,CAAC;IACnF,OAAO,IAAI,CAACF,UAAU,CAACmB,SAAS,CAACE,mBAAmB,CAACH,aAAa,CAAC;EACvE,CAAC;EAED;AACJ;AACA;EACI,IAAIX,CAACA,CAAA,EAAoC;IACrC,IAAMV,KAA6B,GAAG,IAAW;IACjD,OAAOA,KAAK,CAACG,UAAU,CAACO,CAAC,CAACC,IAAI,CAC1BhC,MAAM,CAAC8C,WAAW,IAAI,CAACA,WAAW,CAACC,OAAO,CAAC,EAC3C/C,MAAM,CAAC8C,WAAW,IAAIA,WAAW,CAACE,UAAU,KAAK,IAAI,CAACtB,OAAO,CAAC,EAC9DzB,GAAG,CAAC6C,WAAW,IAAIhC,8BAA8B,CAACgC,WAAW,CAAC,CAAC,EAC/D3C,SAAS,CAACkB,KAAK,CAACG,UAAU,CAACmB,SAAS,CAACC,qBAAqB,CAAC,IAAI,CAAClB,OAAO,CAAC,CAAC,EACzE3B,oBAAoB,CAAC,CAACkD,IAAI,EAAEC,IAAI,KAAKD,IAAI,CAACpB,IAAI,KAAKqB,IAAI,CAACrB,IAAI,CAAC,EAC7D5B,GAAG,CAACkD,OAAO,IAAK,IAAI,CAAqB3B,UAAU,CAACmB,SAAS,CAACE,mBAAmB,CAACM,OAAO,CAAC,CAAC,EAC3FjD,WAAW,CAACO,0BAA0B,CAC1C,CAAC;EACL,CAAC;EACD,IAAI2C,EAAEA,CAAA,EAAQ;IACV,IAAM/B,KAAiB,GAAG,IAAW;IACrC,IAAMe,UAAU,GAAGf,KAAK,CAACG,UAAU,CAACa,QAAQ,CAACC,oBAAoB,CAAC,CAAC;IACnE,OAAOF,UAAU,CAACG,cAAc,CAC5BlB,KAAK,CAACU,CAAC,EACPV,KAAK,CAACmB,SAAS,CAAC,CAAC,CAACb,KAAK,EACvBN,KAAK,CAACG,UAAU,CAACa,QACrB,CAAC;EACL,CAAC;EAED;AACJ;AACA;EACIgB,IAAIA,CAAmBC,IAAY,EAAmB;IAClD,IAAIvC,YAAY,CAACwC,SAAS,CAAC,CAAC,EAAE;MAC1B,IAAID,IAAI,CAACE,QAAQ,CAAC,QAAQ,CAAC,EAAE;QACzB,MAAM5C,UAAU,CAAC,MAAM,EAAE;UACrB0C;QACJ,CAAC,CAAC;MACN;MAEA,IAAIA,IAAI,KAAK,IAAI,CAAClC,WAAW,EAAE;QAC3B,MAAMR,UAAU,CAAC,MAAM,CAAC;MAC5B;;MAEA;MACA,IAAI,IAAI,CAACY,UAAU,CAACC,MAAM,CAACgC,WAAW,CAACD,QAAQ,CAACF,IAAI,CAAC,EAAE;QACnD,MAAM1C,UAAU,CAAC,MAAM,EAAE;UACrB0C;QACJ,CAAC,CAAC;MACN;MAEA,IAAMI,SAAS,GAAG1C,qBAAqB,CACnC,IAAI,CAACQ,UAAU,CAACC,MAAM,CAACkC,UAAU,EACjCL,IACJ,CAAC;MAED,IAAI,CAACI,SAAS,EAAE;QACZ,MAAM9C,UAAU,CAAC,MAAM,EAAE;UACrB0C;QACJ,CAAC,CAAC;MACN;IACJ;IAEA,OAAO,IAAI,CAACvB,CAAC,CACRC,IAAI,CACD/B,GAAG,CAAC2D,IAAI,IAAIlD,WAAW,CAACkD,IAAI,EAAEN,IAAI,CAAC,CAAC,EACpCvD,oBAAoB,CAAC,CACzB,CAAC;EACT,CAAC;EACD8D,KAAKA,CAAmBP,IAAY,EAAE;IAClC,IAAMQ,GAAG,GAAG,IAAI,CAACT,IAAI,CAACC,IAAI,CAAC;IAC3B,IAAMlB,UAAU,GAAG,IAAI,CAACZ,UAAU,CAACa,QAAQ,CAACC,oBAAoB,CAAC,CAAC;IAClE,OAAOF,UAAU,CAACG,cAAc,CAC5BuB,GAAG,EACH,IAAI,CAACtB,SAAS,CAAC,CAAC,CAACuB,GAAG,CAACT,IAAI,CAAC,EAC1B,IAAI,CAAC9B,UAAU,CAACa,QACpB,CAAC;EACL,CAAC;EAED;AACJ;AACA;EACI2B,QAAQA,CAAmBV,IAAY,EAA8B;IACjE,IAAMI,SAAS,GAAG1C,qBAAqB,CACnC,IAAI,CAACQ,UAAU,CAACC,MAAM,CAACkC,UAAU,EACjCL,IACJ,CAAC;IACD,IAAMW,KAAK,GAAG,IAAI,CAACF,GAAG,CAACT,IAAI,CAAC;IAC5B,IAAI,CAACW,KAAK,EAAE;MACR,OAAOzD,oBAAoB;IAC/B;IACA,IAAI,CAACkD,SAAS,EAAE;MACZ,MAAM9C,UAAU,CAAC,MAAM,EAAE;QACrB0C;MACJ,CAAC,CAAC;IACN;IACA,IAAI,CAACI,SAAS,CAACQ,GAAG,EAAE;MAChB,MAAMtD,UAAU,CAAC,MAAM,EAAE;QACrB0C,IAAI;QACJI;MACJ,CAAC,CAAC;IACN;IAEA,IAAMS,aAA2B,GAAG,IAAI,CAAC3C,UAAU,CAACa,QAAQ,CAAC+B,WAAW,CAACV,SAAS,CAACQ,GAAG,CAAC;IACvF,IAAI,CAACC,aAAa,EAAE;MAChB,MAAMvD,UAAU,CAAC,MAAM,EAAE;QACrBsD,GAAG,EAAER,SAAS,CAACQ,GAAG;QAClBZ,IAAI;QACJI;MACJ,CAAC,CAAC;IACN;IAEA,IAAIA,SAAS,CAACW,IAAI,KAAK,OAAO,EAAE;MAC5B,OAAOF,aAAa,CAACG,SAAS,CAACL,KAAK,CAAC,CAACM,IAAI,CAAC,CAAC,CAACC,IAAI,CAACC,GAAG,IAAI;QACrD,IAAMC,cAAc,GAAGD,GAAG,CAACE,MAAM,CAAC,CAAC;QACnC,OAAOC,KAAK,CAACC,IAAI,CAACH,cAAc,CAAC;MACrC,CAAC,CAAC;IACN,CAAC,MAAM;MACH,OAAOP,aAAa,CAACW,OAAO,CAACb,KAAK,CAAC,CAACM,IAAI,CAAC,CAAC;IAC9C;EACJ,CAAC;EACD;AACJ;AACA;AACA;AACA;EACIR,GAAGA,CAAmBgB,OAAe,EAAc;IAC/C,OAAOpE,kBAAkB,CACrB,IAAI,CAACqE,cAAc,EACnBD,OAAO,EACP,MAAM;MACF,IAAME,QAAQ,GAAGvE,WAAW,CAAC,IAAI,CAACiB,KAAK,EAAEoD,OAAO,CAAC;;MAEjD;MACA,IACI,OAAOE,QAAQ,KAAK,QAAQ,IAC5BA,QAAQ,KAAK,IAAI,IACjBL,KAAK,CAACM,OAAO,CAACD,QAAQ,CAAC,EACzB;QACE,OAAOlE,YAAY,CAACoE,qBAAqB,CAACF,QAAQ,CAAC;MACvD;MACA,IAAM5D,KAAK,GAAG,IAAI;MAClB,IAAM+D,KAAK,GAAG,IAAIC,KAAK;MACnB;AACpB;AACA;AACA;AACA;MACoB9E,SAAS,CAAC0E,QAAQ,CAAC,EACnB;QACIlB,GAAGA,CAACuB,MAAM,EAAEC,QAAa,EAAE;UACvB,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAE;YAC9B,OAAOD,MAAM,CAACC,QAAQ,CAAC;UAC3B;UACA,IAAMC,QAAQ,GAAGD,QAAQ,CAACE,MAAM,CAACF,QAAQ,CAACG,MAAM,GAAG,CAAC,CAAC;UACrD,IAAIH,QAAQ,CAACI,QAAQ,CAAC,IAAI,CAAC,EAAE;YACzB,IAAMC,GAAG,GAAGL,QAAQ,CAACM,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACjC,OAAOxE,KAAK,CAACwC,KAAK,CAACxD,QAAQ,CAAC0E,OAAO,GAAG,GAAG,GAAGa,GAAG,CAAC,CAAC;UACrD,CAAC,MAAM,IAAIJ,QAAQ,KAAK,GAAG,EAAE;YACzB,IAAMM,IAAG,GAAGP,QAAQ,CAACM,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACjC,OAAOxE,KAAK,CAACgC,IAAI,CAAChD,QAAQ,CAAC0E,OAAO,GAAG,GAAG,GAAGe,IAAG,CAAC,CAAC;UACpD,CAAC,MAAM,IAAIN,QAAQ,KAAK,GAAG,EAAE;YACzB,IAAMO,KAAG,GAAGR,QAAQ,CAACM,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACjC,OAAOxE,KAAK,CAAC2C,QAAQ,CAAC3D,QAAQ,CAAC0E,OAAO,GAAG,GAAG,GAAGgB,KAAG,CAAC,CAAC;UACxD,CAAC,MAAM;YACH,OAAO1E,KAAK,CAAC0C,GAAG,CAAC1D,QAAQ,CAAC0E,OAAO,GAAG,GAAG,GAAGQ,QAAQ,CAAC,CAAC;UACxD;QACJ;MACJ,CAAC,CAAC;MACN,OAAOH,KAAK;IAChB,CACJ,CAAC;EAEL,CAAC;EAEDY,MAAMA,CAAmBC,cAAc,GAAG,KAAK,EAAE;IAC7C,IAAI,CAACA,cAAc,EAAE;MACjB,IAAMrC,IAAI,GAAGrD,SAAS,CAAC,IAAI,CAACoB,KAAK,CAAC;MAClC,OAAQiC,IAAI,CAAS/B,IAAI;MACzB,OAAQ+B,IAAI,CAASsC,YAAY;MACjC,OAAQtC,IAAI,CAAS1B,QAAQ;MAC7B,OAAQ0B,IAAI,CAASuC,KAAK;MAC1B,OAAOpF,YAAY,CAACoE,qBAAqB,CAACvB,IAAI,CAAC;IACnD,CAAC,MAAM;MACH,OAAO7C,YAAY,CAACoE,qBAAqB,CAAC,IAAI,CAACxD,KAAK,CAAC;IACzD;EACJ,CAAC;EACDyE,aAAaA,CAAmBH,cAAc,GAAG,KAAK,EAAE;IACpD,OAAO7F,KAAK,CAAC,IAAI,CAAC4F,MAAM,CAACC,cAAqB,CAAC,CAAC;EACpD,CAAC;EAED;AACJ;AACA;AACA;AACA;EACII,MAAMA,CAACC,UAA4B,EAAE;IACjC,MAAMhG,aAAa,CAAC,QAAQ,CAAC;EACjC,CAAC;EACDiG,iBAAiBA,CAACD,UAA4B,EAAE;IAC5C,MAAMhG,aAAa,CAAC,QAAQ,CAAC;EACjC,CAAC;EACDkG,UAAUA,CAACF,UAA6C,EAAE;IACtD,MAAMhG,aAAa,CAAC,MAAM,CAAC;EAC/B,CAAC;EACDmG,aAAaA,CAAA,EAAG;IACZ,MAAMnG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACDoG,aAAaA,CAAA,EAAG;IACZ,MAAMpG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACDqG,cAAcA,CAAA,EAAG;IACb,MAAMrG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACD,IAAIsG,eAAeA,CAAA,EAAG;IAClB,MAAMtG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EAED,MAAMuG,MAAMA,CAERC,gBAA2C;EAC3C;EACAC,QAAiB,EACE;IACnB,IAAMC,OAAO,GAAG,IAAI,CAACrF,KAAK;IAC1B,IAAMsF,OAAkC,GAAG,MAAM/F,4BAA4B,CAAY4F,gBAAgB,CAAC,CAACE,OAAO,CAAQ;IAC1H,OAAO,IAAI,CAACE,SAAS,CAACD,OAAO,EAAED,OAAO,CAAC;EAC3C,CAAC;EAED;AACJ;AACA;AACA;EACIG,iBAAiBA,CAEbL,gBAAqC;EACrC;EACAC,QAAiB,EACE;IACnB,OAAO,IAAI,CAACvF,UAAU,CAAC4F,qBAAqB,CAACC,QAAQ,CACjD,IAAI,CAAC1F,KAAK,EACVT,4BAA4B,CAAC4F,gBAAgB,CACjD,CAAC,CAACtC,IAAI,CAAC8C,MAAM,IAAI,IAAI,CAAC9F,UAAU,CAACmB,SAAS,CAACE,mBAAmB,CAACyE,MAAM,CAAC,CAAC;EAC3E,CAAC;EAEDC,KAAKA,CAEDA,KAAyB,EAC3B;IACE,IAAMP,OAAO,GAAG,IAAI,CAACrF,KAAK;IAC1B,IAAMsF,OAAO,GAAG7G,KAAK,CAAC4G,OAAO,CAAC;IAC9BQ,MAAM,CACDC,OAAO,CAACF,KAAK,CAAC,CACdG,OAAO,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,KAAK;MAChBX,OAAO,CAASU,CAAC,CAAC,GAAGC,CAAC;IAC3B,CAAC,CAAC;IACN,OAAO,IAAI,CAACV,SAAS,CAACD,OAAO,EAAED,OAAO,CAAC;EAC3C,CAAC;EAED;AACJ;AACA;EACIa,gBAAgBA,CAEZN,KAA8B,EACK;IACnC,OAAO,IAAI,CAACJ,iBAAiB,CAAEhE,OAAO,IAAK;MACvCqE,MAAM,CACDC,OAAO,CAACF,KAAK,CAAC,CACdG,OAAO,CAAC,CAAC,CAACC,CAAC,EAAEC,CAAC,CAAC,KAAK;QAChBzE,OAAO,CAASwE,CAAC,CAAC,GAAGC,CAAC;MAC3B,CAAC,CAAC;MACN,OAAOzE,OAAO;IAClB,CAAC,CAAC;EACN,CAAC;EAED;AACJ;AACA;AACA;EACI,MAAM+D,SAASA,CAEXD,OAAuC,EACvCD,OAAkC,EACJ;IAC9BC,OAAO,GAAG1G,SAAS,CAAC0G,OAAO,CAAC;;IAE5B;IACA,IAAI,IAAI,CAACtF,KAAK,CAACO,QAAQ,EAAE;MACrB,MAAMtB,UAAU,CAAC,OAAO,EAAE;QACtBkH,EAAE,EAAE,IAAI,CAACpG,OAAO;QAChBqG,QAAQ,EAAE;MACd,CAAC,CAAC;IACN;IACA,MAAMC,yBAAyB,CAAC,IAAI,CAACxG,UAAU,EAAEyF,OAAO,EAAED,OAAO,CAAC;IAClE,IAAMiB,WAAW,GAAG,MAAM,IAAI,CAACzG,UAAU,CAAC0G,eAAe,CAACC,SAAS,CAAC,CAAC;MACjEC,QAAQ,EAAEpB,OAAO;MACjBe,QAAQ,EAAEd;IACd,CAAC,CAAC,EAAE,uBAAuB,CAAC;IAE5B,IAAMoB,OAAO,GAAGJ,WAAW,CAACK,KAAK,CAAC,CAAC,CAAC;IACpCrH,0BAA0B,CAAC,IAAI,CAACO,UAAU,EAAE,IAAI,CAACE,OAAO,EAAEuF,OAAO,EAAEoB,OAAO,CAAC;IAE3E,MAAM,IAAI,CAAC7G,UAAU,CAAC+G,SAAS,CAAC,MAAM,EAAE,MAAM,EAAEtB,OAAO,EAAE,IAAI,CAAC;IAC9D,OAAO,IAAI,CAACzF,UAAU,CAACmB,SAAS,CAACE,mBAAmB,CAChDoF,WAAW,CAACO,OAAO,CAAC,CAAC,CACzB,CAAC;EACL,CAAC;EAED;AACJ;AACA;AACA;AACA;EACIC,MAAMA,CAAA,EAAwC;IAC1C,IAAMjH,UAAU,GAAG,IAAI,CAACA,UAAU;IAClC,IAAI,IAAI,CAACiB,OAAO,EAAE;MACd,OAAOiG,OAAO,CAACC,MAAM,CAAC/H,UAAU,CAAC,OAAO,EAAE;QACtCmH,QAAQ,EAAE,IAAI;QACdD,EAAE,EAAE,IAAI,CAACpG;MACb,CAAC,CAAC,CAAC;IACP;IAEA,IAAMkH,WAAW,GAAGrI,SAAS,CAAC,IAAI,CAACoB,KAAK,CAAC;IACzC,IAAIkH,cAAmC;IACvC,OAAOrH,UAAU,CAAC+G,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAEK,WAAW,EAAE,IAAI,CAAC,CAC1DpE,IAAI,CAAC,YAAY;MACdoE,WAAW,CAAC1G,QAAQ,GAAG,IAAI;MAC3B,IAAM+F,WAAW,GAAG,MAAMzG,UAAU,CAAC0G,eAAe,CAACC,SAAS,CAAC,CAAC;QAC5DC,QAAQ,EAAE,IAAI,CAACzG,KAAK;QACpBoG,QAAQ,EAAEa;MACd,CAAC,CAAC,EAAE,oBAAoB,CAAC;MACzB,IAAMP,OAAO,GAAGJ,WAAW,CAACK,KAAK,CAAC,CAAC,CAAC;MACpCrH,0BAA0B,CAACO,UAAU,EAAE,IAAI,CAACE,OAAO,EAAEkH,WAAW,EAAEP,OAAO,CAAC;MAC1E,OAAOJ,WAAW,CAACO,OAAO,CAAC,CAAC,CAAC;IACjC,CAAC,CAAC,CACDhE,IAAI,CAAEsE,OAAO,IAAK;MACfD,cAAc,GAAGC,OAAO;MACxB,OAAO,IAAI,CAACtH,UAAU,CAAC+G,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAEK,WAAW,EAAE,IAAI,CAAC;IACzE,CAAC,CAAC,CACDpE,IAAI,CAAC,MAAM;MACR,OAAO,IAAI,CAAChD,UAAU,CAACmB,SAAS,CAACE,mBAAmB,CAACgG,cAAc,CAAC;IACxE,CAAC,CAAC;EACV,CAAC;EACDE,iBAAiBA,CAAA,EAAwC;IACrD,OAAO,IAAI,CAAC5B,iBAAiB,CAAC,MAAOhE,OAAO,IAAK;MAC7C,MAAM,IAAI,CAAC3B,UAAU,CAAC+G,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAEpF,OAAO,EAAE,IAAI,CAAC;MAC/DA,OAAO,CAACjB,QAAQ,GAAG,IAAI;MACvB,OAAOiB,OAAO;IAClB,CAAC,CAAC,CAACqB,IAAI,CAAC,MAAOwE,MAAM,IAAK;MACtB,MAAM,IAAI,CAACxH,UAAU,CAAC+G,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAES,MAAM,CAACrH,KAAK,EAAEqH,MAAM,CAAC;MACvE,OAAOA,MAAM;IACjB,CAAC,CAAC;EACN,CAAC;EACDC,OAAOA,CAAA,EAAG;IACN,MAAMrI,UAAU,CAAC,OAAO,CAAC;EAC7B;AACJ,CAAC;AAED,OAAO,SAASsI,2BAA2BA,CAACC,KAAK,GAAGhI,aAAa,EAAE;EAC/D,IAAMiI,WAAW,GAAG,SAASC,qBAAqBA,CAE9C7H,UAAwB,EACxB2B,OAA4B,EAC9B;IACE,IAAI,CAAC3B,UAAU,GAAGA,UAAU;;IAE5B;IACA,IAAI,CAACG,KAAK,GAAGwB,OAAO;IACpB,IAAI,CAAC6B,cAAc,GAAG,IAAIsE,GAAG,CAAc,CAAC;;IAE5C;AACR;AACA;AACA;IACQ,IAAI,CAAChI,sBAAsB,GAAG,IAAI;EACtC,CAAC;EACD8H,WAAW,CAACG,SAAS,GAAGJ,KAAK;EAC7B,OAAOC,WAAW;AACtB;AAEA,OAAO,SAASI,qBAAqBA,CACjCJ,WAAgB,EAChB5H,UAAmC,EACnCiI,QAAmC,EACP;EAC5B,IAAMC,GAAG,GAAG,IAAIN,WAAW,CAAC5H,UAAU,EAAEiI,QAAQ,CAAC;EACjD5I,cAAc,CAAC,kBAAkB,EAAE6I,GAAG,CAAC;EACvC,OAAOA,GAAG;AACd;AAEA,OAAO,SAASC,YAAYA,CAACC,GAAQ,EAAW;EAC5C,OAAO,OAAOA,GAAG,KAAK,QAAQ,IAAIA,GAAG,KAAK,IAAI,IAAI,wBAAwB,IAAIA,GAAG;AACrF;AAGA,OAAO,SAAS5B,yBAAyBA,CACrCxG,UAAmC,EACnCyF,OAAuC,EACvCD,OAAkC,EACtB;EACZ;AACJ;AACA;AACA;AACA;AACA;EACIC,OAAO,CAACd,KAAK,GAAGqB,MAAM,CAACqC,MAAM,CACzB,CAAC,CAAC,EACF7C,OAAO,CAACb,KAAK,EACbc,OAAO,CAACd,KACZ,CAAC;;EAED;EACA,IAAIpF,YAAY,CAACwC,SAAS,CAAC,CAAC,EAAE;IAC1B/B,UAAU,CAACC,MAAM,CAACqI,cAAc,CAAC9C,OAAO,EAAEC,OAAO,CAAC;EACtD;EACA,OAAOzF,UAAU,CAAC+G,SAAS,CAAC,KAAK,EAAE,MAAM,EAAEtB,OAAO,EAAED,OAAO,CAAC;AAChE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}