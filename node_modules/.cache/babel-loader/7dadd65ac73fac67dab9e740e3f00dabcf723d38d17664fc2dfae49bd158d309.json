{"ast":null,"code":"import { computeValue } from \"../../core\";\nimport { removeValue, setValue } from \"../../util\";\n/**\n * Adds new fields to documents.\n * Outputs documents that contain all existing fields from the input documents and newly added fields.\n *\n * @param {Iterator} collection\n * @param {Object} expr\n * @param {Options} options\n */\nexport const $addFields = (collection, expr, options) => {\n  const newFields = Object.keys(expr);\n  if (newFields.length === 0) return collection;\n  return collection.map(obj => {\n    const newObj = Object.assign({}, obj);\n    for (const field of newFields) {\n      const newValue = computeValue(obj, expr[field], null, options);\n      if (newValue !== undefined) {\n        setValue(newObj, field, newValue);\n      } else {\n        removeValue(newObj, field);\n      }\n    }\n    return newObj;\n  });\n};","map":{"version":3,"names":["computeValue","removeValue","setValue","$addFields","collection","expr","options","newFields","Object","keys","length","map","obj","newObj","assign","field","newValue","undefined"],"sources":["/Users/abdelghanem/Desktop/tasker/node_modules/mingo/dist/esm/operators/pipeline/addFields.js"],"sourcesContent":["import { computeValue } from \"../../core\";\nimport { removeValue, setValue } from \"../../util\";\n/**\n * Adds new fields to documents.\n * Outputs documents that contain all existing fields from the input documents and newly added fields.\n *\n * @param {Iterator} collection\n * @param {Object} expr\n * @param {Options} options\n */\nexport const $addFields = (collection, expr, options) => {\n    const newFields = Object.keys(expr);\n    if (newFields.length === 0)\n        return collection;\n    return collection.map(((obj) => {\n        const newObj = Object.assign({}, obj);\n        for (const field of newFields) {\n            const newValue = computeValue(obj, expr[field], null, options);\n            if (newValue !== undefined) {\n                setValue(newObj, field, newValue);\n            }\n            else {\n                removeValue(newObj, field);\n            }\n        }\n        return newObj;\n    }));\n};\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,YAAY;AACzC,SAASC,WAAW,EAAEC,QAAQ,QAAQ,YAAY;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,UAAU,GAAGA,CAACC,UAAU,EAAEC,IAAI,EAAEC,OAAO,KAAK;EACrD,MAAMC,SAAS,GAAGC,MAAM,CAACC,IAAI,CAACJ,IAAI,CAAC;EACnC,IAAIE,SAAS,CAACG,MAAM,KAAK,CAAC,EACtB,OAAON,UAAU;EACrB,OAAOA,UAAU,CAACO,GAAG,CAAGC,GAAG,IAAK;IAC5B,MAAMC,MAAM,GAAGL,MAAM,CAACM,MAAM,CAAC,CAAC,CAAC,EAAEF,GAAG,CAAC;IACrC,KAAK,MAAMG,KAAK,IAAIR,SAAS,EAAE;MAC3B,MAAMS,QAAQ,GAAGhB,YAAY,CAACY,GAAG,EAAEP,IAAI,CAACU,KAAK,CAAC,EAAE,IAAI,EAAET,OAAO,CAAC;MAC9D,IAAIU,QAAQ,KAAKC,SAAS,EAAE;QACxBf,QAAQ,CAACW,MAAM,EAAEE,KAAK,EAAEC,QAAQ,CAAC;MACrC,CAAC,MACI;QACDf,WAAW,CAACY,MAAM,EAAEE,KAAK,CAAC;MAC9B;IACJ;IACA,OAAOF,MAAM;EACjB,CAAE,CAAC;AACP,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}